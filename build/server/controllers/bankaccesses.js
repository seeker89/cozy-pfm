// Generated by CoffeeScript 1.6.2
var BankAccess, BankAccount;

BankAccess = require('../models/bankaccess');

BankAccount = require('../models/bankaccount');

module.exports.loadBankAccess = function(req, res, next, bankAccessID) {
  var _this = this;

  return BankAccess.find(bankAccessID, function(err, access) {
    if ((err != null) || (access == null)) {
      return res.send(404, {
        error: "BankAccess not found"
      });
    } else {
      delete access.password;
      req.access = access;
      return next();
    }
  });
};

module.exports.index = function(req, res) {
  return BankAccess.all(function(err, accesses) {
    if (err != null) {
      return res.send(500, {
        error: 'Server error occurred while retrieving data'
      });
    } else {
      return res.send(200, accesses);
    }
  });
};

module.exports.create = function(req, res) {
  return BankAccess.addNewAccess(req.body, function(err, access) {
    var msg;

    if (err != null) {
      if (err.alreadyExist != null) {
        return res.send(409, {
          error: "This bank access already exists"
        });
      } else {
        msg = "Server error while creating bank access. -- " + err;
        return res.send(500, {
          error: msg
        });
      }
    } else {
      return res.send(201, access);
    }
  });
};

module.exports.destroy = function(req, res) {
  return req.access.destroy(function(err) {
    if (err != null) {
      return res.send(500, {
        error: "Server error while deleting the bank access"
      });
    } else {
      return res.send(204, {
        success: true
      });
    }
  });
};

module.exports.update = function(req, res) {
  return req.access.updateAttributes(body, function(err, access) {
    if (err != null) {
      return res.send(500, {
        error: "Server error while saving bank access"
      });
    } else {
      return res.send(200, access);
    }
  });
};

module.exports.show = function(req, res) {
  return res.send(200, req.access);
};

module.exports.getAccounts = function(req, res) {
  return BankAccount.allFromBankAccess(req.access, function(err, accounts) {
    if (err) {
      return res.send(500, {
        error: 'Server error occurred while retrieving data'
      });
    } else {
      return res.send(200, accounts);
    }
  });
};
