// Generated by CoffeeScript 1.6.2
var BankAccess, BankAccount, BankOperation;

BankAccount = require('../models/bankaccount');

BankOperation = require('../models/bankoperation');

BankAccess = require('../models/bankaccess');

module.exports.loadBankAccount = function(req, res, next, accountID) {
  var _this = this;

  return BankAccount.find(accountID, function(err, account) {
    if ((err != null) || (account == null)) {
      return res.send(404, {
        error: "BankAccount not found"
      });
    } else {
      req.account = account;
      return next();
    }
  });
};

module.exports.index = function(req, res) {
  return BankAccount.all(function(err, accounts) {
    if (err != null) {
      return res.send(500, {
        error: 'Server error occurred while retrieving data'
      });
    } else {
      return res.send(200, accounts);
    }
  });
};

module.exports.destroy = function(req, res) {
  return req.account.destroyWithOperations(function(err) {
    if (err != null) {
      return res.send(500, {
        error: err
      });
    } else {
      return res.send(204, {
        success: true
      });
    }
  });
};

module.exports.show = function(req, res) {
  return res.send(200, req.account);
};

module.exports.getOperations = function(req, res) {
  return BankOperation.allFromBankAccountDate(req.account, function(err, operations) {
    if (err != null) {
      return res.send(500, {
        error: 'Server error occurred while retrieving data'
      });
    } else {
      return res.send(200, operations);
    }
  });
};

module.exports.retrieveOperations = function(req, res) {
  var _this = this;

  return BankAccess.find(req.account.bankAccess, function(err, access) {
    var msg;

    if (err != null) {
      msg = "Server error occurred while retrieving data -- " + err;
      return res.send(500, {
        error: msg
      });
    } else {
      return access.retrieveOperations(function(err) {
        if (err != null) {
          msg = "Server error occurred while retrieving data";
          return res.send(500, {
            error: "" + msg + " -- " + err
          });
        } else {
          return res.send(200, req.account);
        }
      });
    }
  });
};
